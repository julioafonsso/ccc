package br.com.julios.ccc.componentes;

import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;

import org.apache.commons.mail.DefaultAuthenticator;
import org.apache.commons.mail.EmailException;
import org.apache.commons.mail.HtmlEmail;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import br.com.julios.ccc.infra.bd.model.AulaParticularDO;
import br.com.julios.ccc.infra.bd.model.ComissaoProfessorDO;
import br.com.julios.ccc.infra.bd.model.FluxoCaixaDO;
import br.com.julios.ccc.infra.bd.model.FuncionarioDO;
import br.com.julios.ccc.infra.bd.model.MatriculaDO;
import br.com.julios.ccc.infra.bd.model.MensagemEmailDO;
import br.com.julios.ccc.infra.bd.model.MensalidadeDO;

@Service
public class EmailApi {

	@Autowired
	EmailProperties emailProperties;

	// @Autowired
	// private MsgEmailDAO msgEmail;

	public static void main(String[] args) throws Exception {
		EmailApi e = new EmailApi();
		e.enviarEmailReciboMensalidade(null);
	}

	public void enviarEmailAulaParticular(MatriculaDO matricula, AulaParticularDO aula, FluxoCaixaDO fluxo)
			throws Exception {
		SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

		if(matricula.getEmailAluno() == null || matricula.getEmailAluno().length() == 0) 
			return;
		
		HtmlEmail email = getConfigHmlEmail();
		email.addTo(matricula.getEmailAluno());
		email.setSubject(
				"Recibo Aula Particular " + matricula.getNomeModalidade() + " " + matricula.getNomeNivel());

		StringBuilder builder = new StringBuilder();

		builder.append(
				"<!doctype html><html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office'><head> <meta charset='UTF-8'> <meta http-equiv='X-UA-Compatible' content='IE=edge'> <meta name='viewport' content='width=device-width, initial-scale=1'> <title>{{titulo}}</title> <style type='text/css'> tr.border_bottom{border-bottom: 1px solid black;}td.border_right{border-right: 1px solid black;}p{margin: 10px 0; padding: 0;}b{font-family: Helvetica; font-size: 14px;}table{border-collapse: collapse;}h1, h2, h3, h4, h5, h6{display: block; margin: 0; padding: 0;}body, #bodyTable, #bodyCell{height: 100%; margin: 0; padding: 0; width: 100%;}#templateBody{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateBody .mcnTextContent, #templateBody .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateBody .mcnTextContent a, #templateBody .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateColumns{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 2px solid #EAEAEA; padding-top: 0; padding-bottom: 9px;}#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateColumns .columnContainer .mcnTextContent a, #templateColumns .columnContainer .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateFooter{background-color: #FAFAFA; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{color: #656565; font-family: Helvetica; font-size: 12px; line-height: 150%; text-align: center;}#templateFooter .mcnTextContent a, #templateFooter .mcnTextContent p a{color: #656565; font-weight: normal; text-decoration: underline;}@media only screen and (min-width:768px){.templateContainer{width: 600px !important;}}@media only screen and (max-width: 480px){body, table, td, p, a, li, blockquote{-webkit-text-size-adjust: none !important;}}@media only screen and (max-width: 480px){body{width: 100% !important; min-width: 100% !important;}}@media only screen and (max-width: 480px){#bodyCell{padding-top: 10px !important;}}@media only screen and (max-width: 480px){.columnWrapper{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImage{width: 100% !important;}}@media only screen and (max-width: 480px){.mcnCartContainer, .mcnCaptionTopContent, .mcnRecContentContainer, .mcnCaptionBottomContent, .mcnTextContentContainer, .mcnBoxedTextContentContainer, .mcnImageGroupContentContainer, .mcnCaptionLeftTextContentContainer, .mcnCaptionRightTextContentContainer, .mcnCaptionLeftImageContentContainer, .mcnCaptionRightImageContentContainer, .mcnImageCardLeftTextContentContainer, .mcnImageCardRightTextContentContainer{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer{min-width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImageGroupContent{padding: 9px !important;}}@media only screen and (max-width: 480px){.mcnCaptionLeftContentOuter .mcnTextContent, .mcnCaptionRightContentOuter .mcnTextContent{padding-top: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageCardTopImageContent, .mcnCaptionBlockInner .mcnCaptionTopContent:last-child .mcnTextContent{padding-top: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardBottomImageContent{padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockInner{padding-top: 0 !important; padding-bottom: 0 !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockOuter{padding-top: 9px !important; padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnTextContent, .mcnBoxedTextContentColumn{padding-right: 18px !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardLeftImageContent, .mcnImageCardRightImageContent{padding-right: 18px !important; padding-bottom: 0 !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcpreview-image-uploader{display: none !important; width: 100% !important;}}@media only screen and (max-width: 480px){h1{font-size: 22px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h2{font-size: 20px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h3{font-size: 18px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h4{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer .mcnTextContent, .mcnBoxedTextContentContainer .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templatePreheader{display: block !important;}}@media only screen and (max-width: 480px){#templatePreheader .mcnTextContent, #templatePreheader .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateHeader .mcnTextContent, #templateHeader .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateBody .mcnTextContent, #templateBody .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}</style></head><body> <center> <table align='left' border='0' height='100%' width='100%' id='bodyTable'> <tr> <td align='left' valign='top' id='templateHeader'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='headerContainer'> <table border='0' width='100%' class='mcnImageBlock' style='min-width:100%;'> <tbody class='mcnImageBlockOuter'> <tr> <td valign='top' style='padding:9px' class='mcnImageBlockInner'> <table align='left' width='100%' border='0' class='mcnImageContentContainer' style='min-width:100%;'> <tbody> <tr> <td class='mcnImageContent' valign='top' style='padding-right: 9px; padding-left: 9px; padding-top: 0; padding-bottom: 0; text-align:center;'><img align='left' alt='' src='http://controle-ccc.website/imagens/logo_email2.jpg' width='320' style='max-width:320px; padding-bottom: 0; display: inline !important; vertical-align: bottom;' class='mcnImage'></td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateBody'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='bodyContainer'> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'> <p style='font-family: Helvetica;font-size: 14px;'>Prezado Aluno, você está recebendo o seu comprovante de pagamento. Enquanto for aluno Dança CCC todos os seus pagamentos terão os recibos instantaneamente enviados para esse endereço de e-mail, que você forneceu para nós no ato da sua inscrição.</p><br><h2>{{subtitulo}}</h2> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='1' width='100%' class='templateContainer'> <tr> <td> <table align='left' width='100%' class='templateContainer'> <tr class='border_bottom'> <td> <table align='center ' width='100%' class='templateContainer'> <tr> <td class='border_right'><b>Modalidade</b>:{{modalidade}}</td><td class='border_right'><b>Qtd Aulas </b>:{{qtd}}</td><td><b>Professor</b>:{{professor}}</td></tr></table> </td></tr><tr> <td> <table align='left' width='100%' class='templateContainer'> <tr> <td> <p><b>Aluno:</b>{{aluno}}</p></td></tr></table> </td></tr></table> </td><td><b>Valor</b> <p>R${{valor}}</p></td></tr></table> <table align='left' width='100%'> <tr> <td style='text-align: right'><b> Data </b>{{data}}</td></tr></table> <b> <table align='center' width='100%'> <tr> <td align=center>{{MENSAGEM}}</td></tr></table> </b> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateColumns'> <table border='0' width='100%' class='templateContainer'> <tr> <td valign='top'> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateFooter'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='footerContainer'> <table border='0' width='100%' class='mcnFollowBlock' style='min-width:100%;'> <tbody class='mcnFollowBlockOuter'> <tr> <td align='left' valign='top' style='padding:9px' class='mcnFollowBlockInner'> <table border='0' width='100%' class='mcnFollowContentContainer' style='min-width:100%;'> <tbody> <tr> <td align='left' style='padding-left:9px;padding-right:9px;'> <table border='0' width='100%' style='min-width:100%;' class='mcnFollowContent'> <tbody> <tr> <td align='left' valign='top' style='padding-top:9px; padding-right:9px; padding-left:9px;'> <table align='left' border='0'> <tbody> <tr> <td align='left' valign='top'> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.instagram.com/danca_ccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.facebook.com/dancaccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:0; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='http://dancaccc.com.br' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-link-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'>&nbsp;Qualquer dúvida sobre como proceder em relação a assuntos ligados à sua matricula, clique <a href='http://dancaccc.com.br/carta-boas-vindas-regulamento/' target='_blank'>aqui</a>&nbsp;ou ligue (21) 3176-1462 de segunda à sexta das 12hs às 21hs e fale com&nbsp;um de nossos funcionários.</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr></table> </td></tr></table> </center></body></html>");

		int index = builder.indexOf("{{modalidade}}");
		builder.replace(index, index + 14, matricula.getNomeModalidade());

		index = builder.indexOf("{{qtd}}");
		builder.replace(index, index + 7, aula.getQtdAulasContratadas().toString());

		index = builder.indexOf("{{professor}}");
		builder.replace(index, index + 13, aula.getNomeProfessor());

		index = builder.indexOf("{{titulo}}");
		builder.replace(index, index + 10, "Recibo Aula Particular");

		index = builder.indexOf("{{valor}}");
		builder.replace(index, index + 9, new DecimalFormat("#.##").format(fluxo.getValor()));

		index = builder.indexOf("{{aluno}}");
		builder.replace(index, index + 9, matricula.getNomeAluno());

		index = builder.indexOf("{{data}}");
		builder.replace(index, index + 8, sdf.format(new Date()));

		index = builder.indexOf("{{MENSAGEM}}");
		builder.replace(index, index + 12, getMensagem());
		
		index = builder.indexOf("{{subtitulo}}");
		builder.replace(index, index + 13, "Recibo de Aula Particular");
		
		email.setContent(builder.toString(), "text/html; charset=utf-8");
		try {
			email.send();
		} catch (EmailException e) {
			throw new RuntimeException(
					"Falha ao enviar o comprovante para o email. Favor verificar se o email esta correto. ");
		}
	}

	public void enviarEmailReciboMatricula(MatriculaDO matricula, FluxoCaixaDO fluxo) throws Exception {
		SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

		if(matricula.getEmailAluno() == null || matricula.getEmailAluno().length() == 0) 
			return;
		
		HtmlEmail email = getConfigHmlEmail();
		email.addTo(matricula.getEmailAluno());
		email.setSubject(
				"Recibo Pagamento Matricula " + matricula.getNomeModalidade() + " " + matricula.getNomeNivel());

		StringBuilder builder = new StringBuilder();

		builder.append(
				"<!doctype html><html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office'><head> <meta charset='UTF-8'> <meta http-equiv='X-UA-Compatible' content='IE=edge'> <meta name='viewport' content='width=device-width, initial-scale=1'> <title>{{titulo}}</title> <style type='text/css'> tr.border_bottom{border-bottom: 1px solid black;}td.border_right{border-right: 1px solid black;}p{margin: 10px 0; padding: 0;}b{font-family: Helvetica; font-size: 14px;}table{border-collapse: collapse;}h1, h2, h3, h4, h5, h6{display: block; margin: 0; padding: 0;}body, #bodyTable, #bodyCell{height: 100%; margin: 0; padding: 0; width: 100%;}#templateBody{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateBody .mcnTextContent, #templateBody .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateBody .mcnTextContent a, #templateBody .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateColumns{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 2px solid #EAEAEA; padding-top: 0; padding-bottom: 9px;}#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateColumns .columnContainer .mcnTextContent a, #templateColumns .columnContainer .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateFooter{background-color: #FAFAFA; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{color: #656565; font-family: Helvetica; font-size: 12px; line-height: 150%; text-align: center;}#templateFooter .mcnTextContent a, #templateFooter .mcnTextContent p a{color: #656565; font-weight: normal; text-decoration: underline;}@media only screen and (min-width:768px){.templateContainer{width: 600px !important;}}@media only screen and (max-width: 480px){body, table, td, p, a, li, blockquote{-webkit-text-size-adjust: none !important;}}@media only screen and (max-width: 480px){body{width: 100% !important; min-width: 100% !important;}}@media only screen and (max-width: 480px){#bodyCell{padding-top: 10px !important;}}@media only screen and (max-width: 480px){.columnWrapper{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImage{width: 100% !important;}}@media only screen and (max-width: 480px){.mcnCartContainer, .mcnCaptionTopContent, .mcnRecContentContainer, .mcnCaptionBottomContent, .mcnTextContentContainer, .mcnBoxedTextContentContainer, .mcnImageGroupContentContainer, .mcnCaptionLeftTextContentContainer, .mcnCaptionRightTextContentContainer, .mcnCaptionLeftImageContentContainer, .mcnCaptionRightImageContentContainer, .mcnImageCardLeftTextContentContainer, .mcnImageCardRightTextContentContainer{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer{min-width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImageGroupContent{padding: 9px !important;}}@media only screen and (max-width: 480px){.mcnCaptionLeftContentOuter .mcnTextContent, .mcnCaptionRightContentOuter .mcnTextContent{padding-top: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageCardTopImageContent, .mcnCaptionBlockInner .mcnCaptionTopContent:last-child .mcnTextContent{padding-top: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardBottomImageContent{padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockInner{padding-top: 0 !important; padding-bottom: 0 !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockOuter{padding-top: 9px !important; padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnTextContent, .mcnBoxedTextContentColumn{padding-right: 18px !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardLeftImageContent, .mcnImageCardRightImageContent{padding-right: 18px !important; padding-bottom: 0 !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcpreview-image-uploader{display: none !important; width: 100% !important;}}@media only screen and (max-width: 480px){h1{font-size: 22px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h2{font-size: 20px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h3{font-size: 18px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h4{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer .mcnTextContent, .mcnBoxedTextContentContainer .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templatePreheader{display: block !important;}}@media only screen and (max-width: 480px){#templatePreheader .mcnTextContent, #templatePreheader .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateHeader .mcnTextContent, #templateHeader .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateBody .mcnTextContent, #templateBody .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}</style></head><body> <center> <table align='left' border='0' height='100%' width='100%' id='bodyTable'> <tr> <td align='left' valign='top' id='templateHeader'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='headerContainer'> <table border='0' width='100%' class='mcnImageBlock' style='min-width:100%;'> <tbody class='mcnImageBlockOuter'> <tr> <td valign='top' style='padding:9px' class='mcnImageBlockInner'> <table align='left' width='100%' border='0' class='mcnImageContentContainer' style='min-width:100%;'> <tbody> <tr> <td class='mcnImageContent' valign='top' style='padding-right: 9px; padding-left: 9px; padding-top: 0; padding-bottom: 0; text-align:center;'><img align='left' alt='' src='http://controle-ccc.website/imagens/logo_email2.jpg' width='320' style='max-width:320px; padding-bottom: 0; display: inline !important; vertical-align: bottom;' class='mcnImage'></td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateBody'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='bodyContainer'> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'> <p style='font-family: Helvetica;font-size: 14px;'>Prezado Aluno, você está recebendo o seu comprovante de pagamento. Enquanto for aluno Dança CCC todos os seus pagamentos terão os recibos instantaneamente enviados para esse endereço de e-mail, que você forneceu para nós no ato da sua inscrição.</p><br><h2>{{subtitulo}}</h2> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='1' width='100%' class='templateContainer'> <tr> <td> <table align='left' width='100%' class='templateContainer'> <tr class='border_bottom'> <td> <table align='center ' width='100%' class='templateContainer'> <tr> <td class='border_right'><b>Turma</b>:{{turma}}</td><td class='border_right'><b>Dias </b>:{{dias}}</td><td><b>Horarios</b>:{{horario}}</td></tr></table> </td></tr><tr> <td> <table align='left' width='100%' class='templateContainer'> <tr> <td> <p><b>Aluno:</b>{{aluno}}</p></td></tr></table> </td></tr></table> </td><td><b>Valor</b> <p>R${{valor}}</p></td></tr></table> <table align='left' width='100%'> <tr> <td><b>Cod:</b>{{codTurma}}</td><td style='text-align: center'><b> Data </b>{{data}}</td></tr></table> <b> <table align='center' width='100%'> <tr> <td align=center>{{MENSAGEM}}</td></tr></table> </b> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateColumns'> <table border='0' width='100%' class='templateContainer'> <tr> <td valign='top'> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateFooter'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='footerContainer'> <table border='0' width='100%' class='mcnFollowBlock' style='min-width:100%;'> <tbody class='mcnFollowBlockOuter'> <tr> <td align='left' valign='top' style='padding:9px' class='mcnFollowBlockInner'> <table border='0' width='100%' class='mcnFollowContentContainer' style='min-width:100%;'> <tbody> <tr> <td align='left' style='padding-left:9px;padding-right:9px;'> <table border='0' width='100%' style='min-width:100%;' class='mcnFollowContent'> <tbody> <tr> <td align='left' valign='top' style='padding-top:9px; padding-right:9px; padding-left:9px;'> <table align='left' border='0'> <tbody> <tr> <td align='left' valign='top'> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.instagram.com/danca_ccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.facebook.com/dancaccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:0; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='http://dancaccc.com.br' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-link-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'>&nbsp;Qualquer dúvida sobre como proceder em relação a assuntos ligados à sua matricula, clique <a href='http://dancaccc.com.br/carta-boas-vindas-regulamento/' target='_blank'>aqui</a>&nbsp;ou ligue (21) 3176-1462 de segunda à sexta das 12hs às 21hs e fale com&nbsp;um de nossos funcionários.</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr></table> </td></tr></table> </center></body></html>");

		int index = builder.indexOf("{{turma}}");
		builder.replace(index, index + 9, matricula.getNomeModalidade());

		index = builder.indexOf("{{dias}}");
		builder.replace(index, index + 8, matricula.getDiasTurmas());

		index = builder.indexOf("{{horario}}");
		builder.replace(index, index + 11, matricula.getHorarioTurma());

		index = builder.indexOf("{{valor}}");
		builder.replace(index, index + 9, new DecimalFormat("#.##").format(fluxo.getValor()));

		index = builder.indexOf("{{aluno}}");
		builder.replace(index, index + 9, matricula.getNomeAluno());

		index = builder.indexOf("{{codTurma}}");
		builder.replace(index, index + 12, matricula.getCodigoTurma());

		index = builder.indexOf("{{data}}");
		builder.replace(index, index + 8, sdf.format(new Date()));

		index = builder.indexOf("{{titulo}}");
		builder.replace(index, index + 10, "Recibo Matricula");
		
		index = builder.indexOf("{{MENSAGEM}}");
		builder.replace(index, index + 12, getMensagem());
		
		index = builder.indexOf("{{subtitulo}}");
		builder.replace(index, index + 13, "Recibo de Matricula");

		System.out.println(builder.toString());
		email.setContent(builder.toString(), "text/html; charset=utf-8");
		try {
			email.send();
		} catch (EmailException e) {
			throw new RuntimeException(
					"Falha ao enviar o comprovante para o email. Favor verificar se o email esta correto. ");
		}
	}

	public void enviarEmailReciboMensalidade(MensalidadeDO mensalidade) throws Exception{
		
		if(mensalidade.getMatricula().getEmailAluno() == null || mensalidade.getMatricula().getEmailAluno().length() == 0) 
			return;
		
			SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

			HtmlEmail email = getConfigHmlEmail();
			email.addTo(mensalidade.getMatricula().getEmailAluno());
			email.setSubject("Recibo Pagamento Mensalidade " + mensalidade.getMatricula().getNomeModalidade() + " "
					+ mensalidade.getMatricula().getNomeNivel() + " - Mes " + mensalidade.getNomeMes());

			StringBuilder builder = new StringBuilder();

			builder.append(
					"<!doctype html><html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office'><head> <meta charset='UTF-8'> <meta http-equiv='X-UA-Compatible' content='IE=edge'> <meta name='viewport' content='width=device-width, initial-scale=1'> <title>{{titulo}}</title> <style type='text/css'> tr.border_bottom{border-bottom: 1px solid black;}td.border_right{border-right: 1px solid black;}p{margin: 10px 0; padding: 0;}b{font-family: Helvetica; font-size: 14px;}table{border-collapse: collapse;}h1, h2, h3, h4, h5, h6{display: block; margin: 0; padding: 0;}body, #bodyTable, #bodyCell{height: 100%; margin: 0; padding: 0; width: 100%;}#templateBody{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateBody .mcnTextContent, #templateBody .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateBody .mcnTextContent a, #templateBody .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateColumns{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 2px solid #EAEAEA; padding-top: 0; padding-bottom: 9px;}#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateColumns .columnContainer .mcnTextContent a, #templateColumns .columnContainer .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateFooter{background-color: #FAFAFA; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{color: #656565; font-family: Helvetica; font-size: 12px; line-height: 150%; text-align: center;}#templateFooter .mcnTextContent a, #templateFooter .mcnTextContent p a{color: #656565; font-weight: normal; text-decoration: underline;}@media only screen and (min-width:768px){.templateContainer{width: 600px !important;}}@media only screen and (max-width: 480px){body, table, td, p, a, li, blockquote{-webkit-text-size-adjust: none !important;}}@media only screen and (max-width: 480px){body{width: 100% !important; min-width: 100% !important;}}@media only screen and (max-width: 480px){#bodyCell{padding-top: 10px !important;}}@media only screen and (max-width: 480px){.columnWrapper{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImage{width: 100% !important;}}@media only screen and (max-width: 480px){.mcnCartContainer, .mcnCaptionTopContent, .mcnRecContentContainer, .mcnCaptionBottomContent, .mcnTextContentContainer, .mcnBoxedTextContentContainer, .mcnImageGroupContentContainer, .mcnCaptionLeftTextContentContainer, .mcnCaptionRightTextContentContainer, .mcnCaptionLeftImageContentContainer, .mcnCaptionRightImageContentContainer, .mcnImageCardLeftTextContentContainer, .mcnImageCardRightTextContentContainer{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer{min-width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImageGroupContent{padding: 9px !important;}}@media only screen and (max-width: 480px){.mcnCaptionLeftContentOuter .mcnTextContent, .mcnCaptionRightContentOuter .mcnTextContent{padding-top: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageCardTopImageContent, .mcnCaptionBlockInner .mcnCaptionTopContent:last-child .mcnTextContent{padding-top: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardBottomImageContent{padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockInner{padding-top: 0 !important; padding-bottom: 0 !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockOuter{padding-top: 9px !important; padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnTextContent, .mcnBoxedTextContentColumn{padding-right: 18px !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardLeftImageContent, .mcnImageCardRightImageContent{padding-right: 18px !important; padding-bottom: 0 !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcpreview-image-uploader{display: none !important; width: 100% !important;}}@media only screen and (max-width: 480px){h1{font-size: 22px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h2{font-size: 20px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h3{font-size: 18px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h4{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer .mcnTextContent, .mcnBoxedTextContentContainer .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templatePreheader{display: block !important;}}@media only screen and (max-width: 480px){#templatePreheader .mcnTextContent, #templatePreheader .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateHeader .mcnTextContent, #templateHeader .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateBody .mcnTextContent, #templateBody .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}</style></head><body> <center> <table align='left' border='0' height='100%' width='100%' id='bodyTable'> <tr> <td align='left' valign='top' id='templateHeader'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='headerContainer'> <table border='0' width='100%' class='mcnImageBlock' style='min-width:100%;'> <tbody class='mcnImageBlockOuter'> <tr> <td valign='top' style='padding:9px' class='mcnImageBlockInner'> <table align='left' width='100%' border='0' class='mcnImageContentContainer' style='min-width:100%;'> <tbody> <tr> <td class='mcnImageContent' valign='top' style='padding-right: 9px; padding-left: 9px; padding-top: 0; padding-bottom: 0; text-align:center;'><img align='left' alt='' src='http://controle-ccc.website/imagens/logo_email2.jpg' width='320' style='max-width:320px; padding-bottom: 0; display: inline !important; vertical-align: bottom;' class='mcnImage'></td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateBody'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='bodyContainer'> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'> <p style='font-family: Helvetica;font-size: 14px;'> Prezado Aluno, você está recebendo o seu comprovante de pagamento. Enquanto for aluno Dança CCC todos os seus pagamentos terão os recibos instantaneamente enviados para esse endereço de e-mail, que você forneceu para nós no ato da sua inscrição.</p><br><h2>{{subtitulo}}</h2> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='1' width='100%' class='templateContainer'> <tr> <td> <table align='left' width='100%' class='templateContainer'> <tr class='border_bottom'> <td> <table align='center ' width='100%' class='templateContainer'> <tr> <td class='border_right'><b>Turma</b>:{{turma}}</td><td class='border_right'><b>Dias </b>:{{dias}}</td><td><b>Horarios</b>:{{horario}}</td></tr></table> </td></tr><tr> <td> <table align='left' width='100%' class='templateContainer'> <tr> <td> <td><b>Ref:</b>{{mesReferencia}}<p><b>Aluno:</b>{{aluno}}</p></td></td></tr></table> </td></tr></table> </td><td><b>Valor</b> <p>R${{valor}}</p></td></tr></table> <table align='left' width='100%'> <tr> <td><b>Cod:</b>{{codTurma}}</td><td style='text-align: center'><b> Data </b>{{data}}</td></tr></table> <b> <table align='center' width='100%'> <tr> <td align=center>{{MENSAGEM}}</td></tr></table> </b> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateColumns'> <table border='0' width='100%' class='templateContainer'> <tr> <td valign='top'> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateFooter'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='footerContainer'> <table border='0' width='100%' class='mcnFollowBlock' style='min-width:100%;'> <tbody class='mcnFollowBlockOuter'> <tr> <td align='left' valign='top' style='padding:9px' class='mcnFollowBlockInner'> <table border='0' width='100%' class='mcnFollowContentContainer' style='min-width:100%;'> <tbody> <tr> <td align='left' style='padding-left:9px;padding-right:9px;'> <table border='0' width='100%' style='min-width:100%;' class='mcnFollowContent'> <tbody> <tr> <td align='left' valign='top' style='padding-top:9px; padding-right:9px; padding-left:9px;'> <table align='left' border='0'> <tbody> <tr> <td align='left' valign='top'> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.instagram.com/danca_ccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.facebook.com/dancaccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:0; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='http://dancaccc.com.br' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-link-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'>&nbsp;Qualquer dúvida sobre como proceder em relação a assuntos ligados à sua matricula, clique <a href='http://dancaccc.com.br/carta-boas-vindas-regulamento/' target='_blank'>aqui</a>&nbsp;ou ligue (21) 3176-1462 de segunda à sexta das 12hs às 21hs e fale com&nbsp;um de nossos funcionários.</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr></table> </td></tr></table> </center></body></html>");

			int index = builder.indexOf("{{turma}}");
			builder.replace(index, index + 9, mensalidade.getMatricula().getNomeModalidade());

			index = builder.indexOf("{{dias}}");
			builder.replace(index, index + 8, mensalidade.getMatricula().getDiasTurmas());

			index = builder.indexOf("{{horario}}");
			builder.replace(index, index + 11, mensalidade.getMatricula().getHorarioTurma());

			index = builder.indexOf("{{mesReferencia}}");
			builder.replace(index, index + 17, mensalidade.getNomeMes());

			index = builder.indexOf("{{valor}}");
			builder.replace(index, index + 9, new DecimalFormat("#.##").format(mensalidade.getValorPago()));

			index = builder.indexOf("{{aluno}}");
			builder.replace(index, index + 9, mensalidade.getMatricula().getNomeAluno());

			index = builder.indexOf("{{codTurma}}");
			builder.replace(index, index + 12, mensalidade.getMatricula().getCodigoTurma());

			index = builder.indexOf("{{data}}");
			builder.replace(index, index + 8, sdf.format(new Date()));

			index = builder.indexOf("{{titulo}}");
			builder.replace(index, index + 10, "Recibo Mensalidade");

			index = builder.indexOf("{{MENSAGEM}}");
			builder.replace(index, index + 12, getMensagem());
			
			index = builder.indexOf("{{subtitulo}}");
			builder.replace(index, index + 13, "Recibo de Mensalidade");
			
			System.out.println(builder.toString());
			email.setContent(builder.toString(), "text/html; charset=utf-8");

			try{
				email.send();
			}catch (EmailException e) {
				throw new RuntimeException("Falha ao enviar o comprovante para o email. Favor verificar se o email esta correto.");
			}

	}
	
	public void enviarEmailPagametoProfessor(List<ComissaoProfessorDO> pagamentos, FluxoCaixaDO fluxo,
			FuncionarioDO professor) throws Exception{
		
		if(professor.getEmail() == null || professor.getEmail().length() == 0) 
			return;
		
		HtmlEmail email = getConfigHmlEmail();
		email.addTo(professor.getEmail());
		email.setSubject("Recibo Pagamento ");

		int index = 0;
		SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
		StringBuilder builder = new StringBuilder();
		
		StringBuilder detalheBase = new StringBuilder();
		StringBuilder detalhes = new StringBuilder();
		detalheBase.append("<tr class='border_top'> <td class='border_right'>{{codigo}}</td><td class='border_right'>{{aluno}}</td><td class='border_right'>R$ {{valorpago}}</td><td class='border_right'>{{percentual}} %</td><td>R${{valorrecebido}}</td></tr>");

		for (ComissaoProfessorDO comissao : pagamentos) {
			detalhes.append(detalheBase);
			
			index = detalhes.indexOf("{{codigo}}");
			detalhes.replace(index, index + 10, comissao.getCodigoTurma());
			
			index = detalhes.indexOf("{{aluno}}");
			detalhes.replace(index, index + 9, comissao.getNomeAluno());
			
			index = detalhes.indexOf("{{valorpago}}");
			detalhes.replace(index, index + 13, new DecimalFormat("#.##").format(comissao.getValorPagoMensalidade()));
			
			index = detalhes.indexOf("{{percentual}}");
			detalhes.replace(index, index + 14, comissao.getPercentual().toString());
			
			index = detalhes.indexOf("{{valorrecebido}}");
			detalhes.replace(index, index + 17, new DecimalFormat("#.##").format(comissao.getValor()));
			
		}
		
		builder.append(
				"<!doctype html><html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office'><head> <meta charset='UTF-8'> <meta http-equiv='X-UA-Compatible' content='IE=edge'> <meta name='viewport' content='width=device-width, initial-scale=1'> <title>{{titulo}}</title> <style type='text/css'> .border_bottom{border-bottom: 1px solid black;}.border_top{border-top: 1px solid black;}.border_right{border-right: 1px solid black;}p{margin: 10px 0; padding: 0;}b{font-family: Helvetica; font-size: 14px;}table{border-collapse: collapse;}h1, h2, h3, h4, h5, h6{display: block; margin: 0; padding: 0;}body, #bodyTable, #bodyCell{height: 100%; margin: 0; padding: 0; width: 100%;}#templateBody{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateBody .mcnTextContent, #templateBody .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateBody .mcnTextContent a, #templateBody .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateColumns{background-color: #FFFFFF; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 2px solid #EAEAEA; padding-top: 0; padding-bottom: 9px;}#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{color: #202020; font-family: Helvetica; font-size: 16px; line-height: 150%; text-align: left;}#templateColumns .columnContainer .mcnTextContent a, #templateColumns .columnContainer .mcnTextContent p a{color: #2BAADF; font-weight: normal; text-decoration: underline;}#templateFooter{background-color: #FAFAFA; background-image: none; background-repeat: no-repeat; background-position: center; background-size: cover; border-top: 0; border-bottom: 0; padding-top: 9px; padding-bottom: 9px;}#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{color: #656565; font-family: Helvetica; font-size: 12px; line-height: 150%; text-align: center;}#templateFooter .mcnTextContent a, #templateFooter .mcnTextContent p a{color: #656565; font-weight: normal; text-decoration: underline;}@media only screen and (min-width:768px){.templateContainer{width: 600px !important;}}@media only screen and (max-width: 480px){body, table, td, p, a, li, blockquote{-webkit-text-size-adjust: none !important;}}@media only screen and (max-width: 480px){body{width: 100% !important; min-width: 100% !important;}}@media only screen and (max-width: 480px){#bodyCell{padding-top: 10px !important;}}@media only screen and (max-width: 480px){.columnWrapper{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImage{width: 100% !important;}}@media only screen and (max-width: 480px){.mcnCartContainer, .mcnCaptionTopContent, .mcnRecContentContainer, .mcnCaptionBottomContent, .mcnTextContentContainer, .mcnBoxedTextContentContainer, .mcnImageGroupContentContainer, .mcnCaptionLeftTextContentContainer, .mcnCaptionRightTextContentContainer, .mcnCaptionLeftImageContentContainer, .mcnCaptionRightImageContentContainer, .mcnImageCardLeftTextContentContainer, .mcnImageCardRightTextContentContainer{max-width: 100% !important; width: 100% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer{min-width: 100% !important;}}@media only screen and (max-width: 480px){.mcnImageGroupContent{padding: 9px !important;}}@media only screen and (max-width: 480px){.mcnCaptionLeftContentOuter .mcnTextContent, .mcnCaptionRightContentOuter .mcnTextContent{padding-top: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageCardTopImageContent, .mcnCaptionBlockInner .mcnCaptionTopContent:last-child .mcnTextContent{padding-top: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardBottomImageContent{padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockInner{padding-top: 0 !important; padding-bottom: 0 !important;}}@media only screen and (max-width: 480px){.mcnImageGroupBlockOuter{padding-top: 9px !important; padding-bottom: 9px !important;}}@media only screen and (max-width: 480px){.mcnTextContent, .mcnBoxedTextContentColumn{padding-right: 18px !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcnImageCardLeftImageContent, .mcnImageCardRightImageContent{padding-right: 18px !important; padding-bottom: 0 !important; padding-left: 18px !important;}}@media only screen and (max-width: 480px){.mcpreview-image-uploader{display: none !important; width: 100% !important;}}@media only screen and (max-width: 480px){h1{font-size: 22px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h2{font-size: 20px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h3{font-size: 18px !important; line-height: 125% !important;}}@media only screen and (max-width: 480px){h4{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer .mcnTextContent, .mcnBoxedTextContentContainer .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templatePreheader{display: block !important;}}@media only screen and (max-width: 480px){#templatePreheader .mcnTextContent, #templatePreheader .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateHeader .mcnTextContent, #templateHeader .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateBody .mcnTextContent, #templateBody .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{font-size: 16px !important; line-height: 150% !important;}}@media only screen and (max-width: 480px){#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{font-size: 14px !important; line-height: 150% !important;}}</style></head><body> <center> <table align='left' border='0' height='100%' width='100%' id='bodyTable'> <tr> <td align='left' valign='top' id='templateHeader'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='headerContainer'> <table border='0' width='100%' class='mcnImageBlock' style='min-width:100%;'> <tbody class='mcnImageBlockOuter'> <tr> <td valign='top' style='padding:9px' class='mcnImageBlockInner'> <table align='left' width='100%' border='0' class='mcnImageContentContainer' style='min-width:100%;'> <tbody> <tr> <td class='mcnImageContent' valign='top' style='padding-right: 9px; padding-left: 9px; padding-top: 0; padding-bottom: 0; text-align:center;'><img align='left' alt='' src='http://controle-ccc.website/imagens/logo_email2.jpg' width='320' style='max-width:320px; padding-bottom: 0; display: inline !important; vertical-align: bottom;' class='mcnImage'></td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateBody'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='bodyContainer'> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'> <h2 align='center'>{{subtitulo}}</h2> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='1' width='100%' class='templateContainer'> <tr> <td> <table align='left' width='100%' class='templateContainer'> <tr class='border_bottom'> <td> <table align='center ' width='100%' class='templateContainer'> <tr> <td class='border_right'><b>Professor</b>:{{professor}}</td><td ><b>CPF </b>:{{cpf}}</td></tr></table> </td></tr><tr class='border_bottom'> <td> <table align='center ' width='100%' class='templateContainer'> <tr > <td align='center'> Detalhes </td></tr></table> </td></tr><tr> <td> <table align='left' width='100%' class='templateContainer'> <thead > <th class='border_right'>Codigo Turma</th> <th class='border_right'>Aluno</th> <th class='border_right'>Valor Pago</th> <th class='border_right'>Percentual</th> <th >Valor Recebido</th> </thead>{{detalhes}}</table> </td></tr></table> </td><td><b>Valor</b> <p>R${{valor}}</p></td></tr></table> <table align='left' width='100%'> <tr> <td style='text-align: right'><b> Data </b>{{data}}</td></tr></table> <b> <table align='center' width='100%'> <tr> <td align=center>{{MENSAGEM}}</td></tr></table> </b> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateColumns'> <table border='0' width='100%' class='templateContainer'> <tr> <td valign='top'> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> <table align='left' border='0' width='200' class='columnWrapper'> <tr> <td valign='top' class='columnContainer'></td></tr></table> </td></tr></table> </td></tr><tr> <td align='left' valign='top' id='templateFooter'> <table align='left' border='0' width='100%' class='templateContainer'> <tr> <td valign='top' class='footerContainer'> <table border='0' width='100%' class='mcnFollowBlock' style='min-width:100%;'> <tbody class='mcnFollowBlockOuter'> <tr> <td align='left' valign='top' style='padding:9px' class='mcnFollowBlockInner'> <table border='0' width='100%' class='mcnFollowContentContainer' style='min-width:100%;'> <tbody> <tr> <td align='left' style='padding-left:9px;padding-right:9px;'> <table border='0' width='100%' style='min-width:100%;' class='mcnFollowContent'> <tbody> <tr> <td align='left' valign='top' style='padding-top:9px; padding-right:9px; padding-left:9px;'> <table align='left' border='0'> <tbody> <tr> <td align='left' valign='top'> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.instagram.com/danca_ccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.facebook.com/dancaccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table align='left' border='0' style='display:inline;'> <tbody> <tr> <td valign='top' style='padding-right:0; padding-bottom:9px;' class='mcnFollowContentItemContainer'> <table border='0' width='100%' class='mcnFollowContentItem'> <tbody> <tr> <td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'> <table align='left' border='0' width=''> <tbody> <tr> <td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='http://dancaccc.com.br' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-link-48.png' style='display:block;' height='24' width='24' class=''></a> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></tbody> </table> <table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'> <tbody class='mcnTextBlockOuter'> <tr> <td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'> <table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'> <tbody> <tr> <td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'>&nbsp;Qualquer dúvida sobre como proceder em relação a assuntos ligados à sua matricula, clique <a href='http://dancaccc.com.br/carta-boas-vindas-regulamento/' target='_blank'>aqui</a>&nbsp;ou ligue (21) 3176-1462 de segunda à sexta das 12hs às 21hs e fale com&nbsp;um de nossos funcionários.</td></tr></tbody> </table> </td></tr></tbody> </table> </td></tr></table> </td></tr></table> </td></tr></table> </center></body></html>");

	
		index = builder.indexOf("{{professor}}");
		builder.replace(index, index + 13, professor.getNome());
		
		index = builder.indexOf("{{cpf}}");
		builder.replace(index, index + 7, professor.getCpf());
		
		index = builder.indexOf("{{subtitulo}}");
		builder.replace(index, index + 13, "Recibo");
		
		index = builder.indexOf("{{data}}");
		builder.replace(index, index + 8, sdf.format(new Date()));
		
		index = builder.indexOf("{{valor}}");
		builder.replace(index, index + 9, new DecimalFormat("#.##").format(fluxo.getValor()));
		
		index = builder.indexOf("{{detalhes}}");
		builder.replace(index, index + 12, detalhes.toString());
		
		index = builder.indexOf("{{MENSAGEM}}");
		builder.replace(index, index + 12, getMensagem());
		
		System.out.println(builder.toString());
		System.out.println("OKKKK");
		email.setContent(builder.toString(), "text/html; charset=utf-8");
			try{
				email.send();
			}catch (EmailException e) {
				throw new RuntimeException("Falha ao enviar o comprovante para o email. Favor verificar se o email esta correto. ");
			}
	}
	
	public void enviarEmailWorkShop(MatriculaDO matricula, FluxoCaixaDO pagamentoWork) throws Exception {

			SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

			HtmlEmail email = getConfigHmlEmail();
			email.addTo(matricula.getEmailAluno());
			email.setSubject("Recibo Pagamento WorkShop " + matricula.getNomeModalidade() );

			StringBuilder builder = new StringBuilder();

			builder.append(
					"<!doctype html><html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office'><head><meta charset='UTF-8'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1'><title>{{titulo}}</title><style type='text/css'>tr.border_bottom{border-bottom:1px solid black}td.border_right{border-right:1px solid black}p{margin:10px 0;padding:0}b{font-family:Helvetica;font-size:14px}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{display:block;margin:0;padding:0}body,#bodyTable,#bodyCell{height:100%;margin:0;padding:0;width:100%}#templateBody{background-color:#FFF;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:0;padding-top:9px;padding-bottom:9px}#templateBody .mcnTextContent, #templateBody .mcnTextContent p{color:#202020;font-family:Helvetica;font-size:16px;line-height:150%;text-align:left}#templateBody .mcnTextContent a, #templateBody .mcnTextContent p a{color:#2BAADF;font-weight:normal;text-decoration:underline}#templateColumns{background-color:#FFF;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:2px solid #EAEAEA;padding-top:0;padding-bottom:9px}#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{color:#202020;font-family:Helvetica;font-size:16px;line-height:150%;text-align:left}#templateColumns .columnContainer .mcnTextContent a, #templateColumns .columnContainer .mcnTextContent p a{color:#2BAADF;font-weight:normal;text-decoration:underline}#templateFooter{background-color:#FAFAFA;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:0;padding-top:9px;padding-bottom:9px}#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{color:#656565;font-family:Helvetica;font-size:12px;line-height:150%;text-align:center}#templateFooter .mcnTextContent a, #templateFooter .mcnTextContent p a{color:#656565;font-weight:normal;text-decoration:underline}@media only screen and (min-width:768px){.templateContainer{width:600px !important}}@media only screen and (max-width: 480px){body,table,td,p,a,li,blockquote{-webkit-text-size-adjust:none !important}}@media only screen and (max-width: 480px){body{width:100% !important;min-width:100% !important}}@media only screen and (max-width: 480px){#bodyCell{padding-top:10px !important}}@media only screen and (max-width: 480px){.columnWrapper{max-width:100% !important;width:100% !important}}@media only screen and (max-width: 480px){.mcnImage{width:100% !important}}@media only screen and (max-width: 480px){.mcnCartContainer,.mcnCaptionTopContent,.mcnRecContentContainer,.mcnCaptionBottomContent,.mcnTextContentContainer,.mcnBoxedTextContentContainer,.mcnImageGroupContentContainer,.mcnCaptionLeftTextContentContainer,.mcnCaptionRightTextContentContainer,.mcnCaptionLeftImageContentContainer,.mcnCaptionRightImageContentContainer,.mcnImageCardLeftTextContentContainer,.mcnImageCardRightTextContentContainer{max-width:100% !important;width:100% !important}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer{min-width:100% !important}}@media only screen and (max-width: 480px){.mcnImageGroupContent{padding:9px !important}}@media only screen and (max-width: 480px){.mcnCaptionLeftContentOuter .mcnTextContent, .mcnCaptionRightContentOuter .mcnTextContent{padding-top:9px !important}}@media only screen and (max-width: 480px){.mcnImageCardTopImageContent, .mcnCaptionBlockInner .mcnCaptionTopContent:last-child .mcnTextContent{padding-top:18px !important}}@media only screen and (max-width: 480px){.mcnImageCardBottomImageContent{padding-bottom:9px !important}}@media only screen and (max-width: 480px){.mcnImageGroupBlockInner{padding-top:0 !important;padding-bottom:0 !important}}@media only screen and (max-width: 480px){.mcnImageGroupBlockOuter{padding-top:9px !important;padding-bottom:9px !important}}@media only screen and (max-width: 480px){.mcnTextContent,.mcnBoxedTextContentColumn{padding-right:18px !important;padding-left:18px !important}}@media only screen and (max-width: 480px){.mcnImageCardLeftImageContent,.mcnImageCardRightImageContent{padding-right:18px !important;padding-bottom:0 !important;padding-left:18px !important}}@media only screen and (max-width: 480px){.mcpreview-image-uploader{display:none !important;width:100% !important}}@media only screen and (max-width: 480px){h1{font-size:22px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h2{font-size:20px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h3{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h4{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer .mcnTextContent, .mcnBoxedTextContentContainer .mcnTextContent p{font-size:14px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templatePreheader{display:block !important}}@media only screen and (max-width: 480px){#templatePreheader .mcnTextContent, #templatePreheader .mcnTextContent p{font-size:14px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateHeader .mcnTextContent, #templateHeader .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateBody .mcnTextContent, #templateBody .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{font-size:14px !important;line-height:150% !important}}</style></head><body><center><table align='left' border='0' height='100%' width='100%' id='bodyTable'><tr><td align='left' valign='top' id='templateHeader'><table align='left' border='0' width='100%' class='templateContainer'><tr><td valign='top' class='headerContainer'><table border='0' width='100%' class='mcnImageBlock' style='min-width:100%;'><tbody class='mcnImageBlockOuter'><tr><td valign='top' style='padding:9px' class='mcnImageBlockInner'><table align='left' width='100%' border='0' class='mcnImageContentContainer' style='min-width:100%;'><tbody><tr><td class='mcnImageContent' valign='top' style='padding-right: 9px; padding-left: 9px; padding-top: 0; padding-bottom: 0; text-align:center;'><img align='left' alt='' src='http://controle-ccc.website/imagens/logo_email2.jpg' width='320' style='max-width:320px; padding-bottom: 0; display: inline !important; vertical-align: bottom;' class='mcnImage'></td></tr></tbody></table></td></tr></tbody></table></td></tr></table></td></tr><tr><td align='left' valign='top' id='templateBody'><table align='left' border='0' width='100%' class='templateContainer'><tr><td valign='top' class='bodyContainer'><table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'><table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'><p style='font-family: Helvetica;font-size: 14px;'>Prezado Aluno, você está recebendo o seu comprovante de pagamento. Enquanto for aluno Dan&#231;a CCC todos os seus pagamentos ter&#227;o os recibos instantaneamente enviados para esse endere&#231;o de e-mail, que você forneceu para nós no ato da sua inscri&#231;&#227;o.</p><br><h2>{{subtitulo}}</h2></td></tr></tbody></table></td></tr></tbody></table><table align='left' border='1' width='100%' class='templateContainer'><tr><td><table align='left' width='100%' class='templateContainer'><tr class='border_bottom'><td><table align='center ' width='100%' class='templateContainer'><tr><td class='border_right'><b>Modalidade</b>:{{modalidade}}</td><td class='border_right'><b>datas </b>:{{datawork}}</td><td><b>Horarios</b>:{{horario}}</td></tr></table></td></tr><tr><td><table align='left' width='100%' class='templateContainer'><tr><td><p><b>Aluno:</b>{{aluno}}</p></td></tr></table></td></tr></table></td><td><b>Valor</b><p>R${{valor}}</p></td></tr></table><table align='left' width='100%'><tr><td style='text-align: right'><b> Data </b>{{data}}</td></tr></table> <b><table align='center' width='100%'><tr><td align=center>{{MENSAGEM}}</td></tr></table> </b></td></tr></table></td></tr><tr><td align='left' valign='top' id='templateColumns'><table border='0' width='100%' class='templateContainer'><tr><td valign='top'><table align='left' border='0' width='200' class='columnWrapper'><tr><td valign='top' class='columnContainer'></td></tr></table><table align='left' border='0' width='200' class='columnWrapper'><tr><td valign='top' class='columnContainer'></td></tr></table><table align='left' border='0' width='200' class='columnWrapper'><tr><td valign='top' class='columnContainer'></td></tr></table></td></tr></table></td></tr><tr><td align='left' valign='top' id='templateFooter'><table align='left' border='0' width='100%' class='templateContainer'><tr><td valign='top' class='footerContainer'><table border='0' width='100%' class='mcnFollowBlock' style='min-width:100%;'><tbody class='mcnFollowBlockOuter'><tr><td align='left' valign='top' style='padding:9px' class='mcnFollowBlockInner'><table border='0' width='100%' class='mcnFollowContentContainer' style='min-width:100%;'><tbody><tr><td align='left' style='padding-left:9px;padding-right:9px;'><table border='0' width='100%' style='min-width:100%;' class='mcnFollowContent'><tbody><tr><td align='left' valign='top' style='padding-top:9px; padding-right:9px; padding-left:9px;'><table align='left' border='0'><tbody><tr><td align='left' valign='top'><table align='left' border='0' style='display:inline;'><tbody><tr><td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'><table border='0' width='100%' class='mcnFollowContentItem'><tbody><tr><td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'><table align='left' border='0' width=''><tbody><tr><td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.instagram.com/danca_ccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png' style='display:block;' height='24' width='24' class=''></a></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><table align='left' border='0' style='display:inline;'><tbody><tr><td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'><table border='0' width='100%' class='mcnFollowContentItem'><tbody><tr><td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'><table align='left' border='0' width=''><tbody><tr><td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.facebook.com/dancaccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png' style='display:block;' height='24' width='24' class=''></a></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><table align='left' border='0' style='display:inline;'><tbody><tr><td valign='top' style='padding-right:0; padding-bottom:9px;' class='mcnFollowContentItemContainer'><table border='0' width='100%' class='mcnFollowContentItem'><tbody><tr><td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'><table align='left' border='0' width=''><tbody><tr><td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='http://dancaccc.com.br' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-link-48.png' style='display:block;' height='24' width='24' class=''></a></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'><table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'>&nbsp;Qualquer dúvida sobre como proceder em rela&#231;&#227;o a assuntos ligados à sua matricula, click <a href='http://www.google.com' target='_blank'>aqui</a>&nbsp;ou ligue (21) 3176-1462 de segunda à sexta das 12:00hs às 21:00hs e fale com&nbsp;um de nossos funcionários.</td></tr></tbody></table></td></tr></tbody></table></td></tr></table></td></tr></table></td></tr></table></center></body></html>");

			int index = builder.indexOf("{{modalidade}}");
			builder.replace(index, index + 14, matricula.getNomeModalidade());

			index = builder.indexOf("{{horario}}");
			builder.replace(index, index + 11, matricula.getHorarioTurma());

			index = builder.indexOf("{{valor}}");
			builder.replace(index, index + 9, new DecimalFormat("#.##").format(pagamentoWork.getValor()));

			index = builder.indexOf("{{aluno}}");
			builder.replace(index, index + 9, matricula.getNomeAluno());

			
			index = builder.indexOf("{{datawork}}");
			builder.replace(index, index + 12, sdf.format(matricula.getDataInicio()));
			
			index = builder.indexOf("{{data}}");
			builder.replace(index, index + 8, sdf.format(new Date()));

			index = builder.indexOf("{{titulo}}");
			builder.replace(index, index + 10, "Recibo WorkShop");

			index = builder.indexOf("{{MENSAGEM}}");
			builder.replace(index, index + 12, getMensagem());
			
			index = builder.indexOf("{{subtitulo}}");
			builder.replace(index, index + 13, "Recibo de WorkShop");
			
			System.out.println(builder.toString());
			email.setContent(builder.toString(), "text/html; charset=utf-8");

			try{
				email.send();
			}catch (EmailException e) {
				throw new RuntimeException("Falha ao enviar o comprovante para o email. Favor verificar se o email esta correto.");
			}

	
	}	
	private String getMensagem() {
		// String msg = msgEmail.getMesage();
		// if(msg == null)
		return "";
		// return msg;
	}

	private HtmlEmail getConfigHmlEmail() throws Exception {
		HtmlEmail email = new HtmlEmail();
		email.setSSLOnConnect(false);
		email.setHostName(emailProperties.getHost());
		email.setSslSmtpPort(emailProperties.getPort());
		email.setSmtpPort(new Integer(emailProperties.getPort()));
		email.setAuthenticator(new DefaultAuthenticator(emailProperties.getOrigem(), emailProperties.getPassword()));
		email.setFrom(emailProperties.getOrigem());

		return email;
	}

	public MensagemEmailDO getMensagemEmail() {
		// return msgEmail.getMensagemEmail();
		return null;
	}

	public void atualizarMensagem(MensagemEmailDO msg) {
		// msgEmail.save(msg);
	}

	public void enviarEmailCobranca(MensalidadeDO mensalidade) throws Exception {
		
		SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

		HtmlEmail email = getConfigHmlEmail();
		email.addTo(mensalidade.getMatricula().getEmailAluno());
		email.setSubject("Pendencia de Pagamento " + mensalidade.getMatricula().getNomeModalidade() );

		StringBuilder builder = new StringBuilder();

		builder.append("<!doctype html><html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office'><head><meta charset='UTF-8'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1'><title>{{titulo}}</title><style type='text/css'>tr.border_bottom{border-bottom:1px solid black}td.border_right{border-right:1px solid black}p{margin:10px 0;padding:0}b{font-family:Helvetica;font-size:14px}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{display:block;margin:0;padding:0}body,#bodyTable,#bodyCell{height:100%;margin:0;padding:0;width:100%}#templateBody{background-color:#FFF;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:0;padding-top:9px;padding-bottom:9px}#templateBody .mcnTextContent, #templateBody .mcnTextContent p{color:#202020;font-family:Helvetica;font-size:16px;line-height:150%;text-align:left}#templateBody .mcnTextContent a, #templateBody .mcnTextContent p a{color:#2BAADF;font-weight:normal;text-decoration:underline}#templateColumns{background-color:#FFF;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:2px solid #EAEAEA;padding-top:0;padding-bottom:9px}#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{color:#202020;font-family:Helvetica;font-size:16px;line-height:150%;text-align:left}#templateColumns .columnContainer .mcnTextContent a, #templateColumns .columnContainer .mcnTextContent p a{color:#2BAADF;font-weight:normal;text-decoration:underline}#templateFooter{background-color:#FAFAFA;background-image:none;background-repeat:no-repeat;background-position:center;background-size:cover;border-top:0;border-bottom:0;padding-top:9px;padding-bottom:9px}#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{color:#656565;font-family:Helvetica;font-size:12px;line-height:150%;text-align:center}#templateFooter .mcnTextContent a, #templateFooter .mcnTextContent p a{color:#656565;font-weight:normal;text-decoration:underline}@media only screen and (min-width:768px){.templateContainer{width:600px !important}}@media only screen and (max-width: 480px){body,table,td,p,a,li,blockquote{-webkit-text-size-adjust:none !important}}@media only screen and (max-width: 480px){body{width:100% !important;min-width:100% !important}}@media only screen and (max-width: 480px){#bodyCell{padding-top:10px !important}}@media only screen and (max-width: 480px){.columnWrapper{max-width:100% !important;width:100% !important}}@media only screen and (max-width: 480px){.mcnImage{width:100% !important}}@media only screen and (max-width: 480px){.mcnCartContainer,.mcnCaptionTopContent,.mcnRecContentContainer,.mcnCaptionBottomContent,.mcnTextContentContainer,.mcnBoxedTextContentContainer,.mcnImageGroupContentContainer,.mcnCaptionLeftTextContentContainer,.mcnCaptionRightTextContentContainer,.mcnCaptionLeftImageContentContainer,.mcnCaptionRightImageContentContainer,.mcnImageCardLeftTextContentContainer,.mcnImageCardRightTextContentContainer{max-width:100% !important;width:100% !important}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer{min-width:100% !important}}@media only screen and (max-width: 480px){.mcnImageGroupContent{padding:9px !important}}@media only screen and (max-width: 480px){.mcnCaptionLeftContentOuter .mcnTextContent, .mcnCaptionRightContentOuter .mcnTextContent{padding-top:9px !important}}@media only screen and (max-width: 480px){.mcnImageCardTopImageContent, .mcnCaptionBlockInner .mcnCaptionTopContent:last-child .mcnTextContent{padding-top:18px !important}}@media only screen and (max-width: 480px){.mcnImageCardBottomImageContent{padding-bottom:9px !important}}@media only screen and (max-width: 480px){.mcnImageGroupBlockInner{padding-top:0 !important;padding-bottom:0 !important}}@media only screen and (max-width: 480px){.mcnImageGroupBlockOuter{padding-top:9px !important;padding-bottom:9px !important}}@media only screen and (max-width: 480px){.mcnTextContent,.mcnBoxedTextContentColumn{padding-right:18px !important;padding-left:18px !important}}@media only screen and (max-width: 480px){.mcnImageCardLeftImageContent,.mcnImageCardRightImageContent{padding-right:18px !important;padding-bottom:0 !important;padding-left:18px !important}}@media only screen and (max-width: 480px){.mcpreview-image-uploader{display:none !important;width:100% !important}}@media only screen and (max-width: 480px){h1{font-size:22px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h2{font-size:20px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h3{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width: 480px){h4{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){.mcnBoxedTextContentContainer .mcnTextContent, .mcnBoxedTextContentContainer .mcnTextContent p{font-size:14px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templatePreheader{display:block !important}}@media only screen and (max-width: 480px){#templatePreheader .mcnTextContent, #templatePreheader .mcnTextContent p{font-size:14px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateHeader .mcnTextContent, #templateHeader .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateBody .mcnTextContent, #templateBody .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateColumns .columnContainer .mcnTextContent, #templateColumns .columnContainer .mcnTextContent p{font-size:16px !important;line-height:150% !important}}@media only screen and (max-width: 480px){#templateFooter .mcnTextContent, #templateFooter .mcnTextContent p{font-size:14px !important;line-height:150% !important}}</style></head><body><center><table align='left' border='0' height='100%' width='100%' id='bodyTable'><tr><td align='left' valign='top' id='templateHeader'><table align='left' border='0' width='100%' class='templateContainer'><tr><td valign='top' class='headerContainer'><table border='0' width='100%' class='mcnImageBlock' style='min-width:100%;'><tbody class='mcnImageBlockOuter'><tr><td valign='top' style='padding:9px' class='mcnImageBlockInner'><table align='left' width='100%' border='0' class='mcnImageContentContainer' style='min-width:100%;'><tbody><tr><td class='mcnImageContent' valign='top' style='padding-right: 9px; padding-left: 9px; padding-top: 0; padding-bottom: 0; text-align:center;'><img align='left' alt='' src='http://controle-ccc.website/imagens/logo_email2.jpg' width='320' style='max-width:320px; padding-bottom: 0; display: inline !important; vertical-align: bottom;' class='mcnImage'></td></tr></tbody></table></td></tr></tbody></table></td></tr></table></td></tr><tr><td align='left' valign='top' id='templateBody'><table align='left' border='0' width='100%' class='templateContainer'><tr><td valign='top' class='bodyContainer'><table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'><table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'><p style='font-family: Helvetica;font-size: 14px;'> Rio de Janeiro, {{data}}</p><br><p style='font-family: Helvetica;font-size: 14px;'> Prezado {{aluno}} , Notamos que não consta em nosso sistema o pagamento da mensalidade referente ao mês de {{mesReferencia}} da turma de {{modalidade}}, na qual você está matriculado, no valor de R$ {{valor}} com vencimento no dia {{dataVencimento}} Se você já efetuou o pagamento, por favor, desconsidere esta mensagem. Se ainda não, informamos que você pode quitar este débito de segunda à sexta entre 12:00 e 21:00 em nossa secretaria ou, se preferir, pode fazê-lo também através de transferência bancária: Banco Itaú, ag 8309 c/c 39465-1 em favor de Espaço Próprio Ltda ME CNPJ 01. 449.0001-32 Envie o comprovante para contato@dancaccc.com.br ou entregue na secretaria quando vier à Escola.</p><br></td></tr></tbody></table></td></tr></tbody></table></tr></table></td></tr><tr><td align='left' valign='top' id='templateColumns'><table border='0' width='100%' class='templateContainer'><tr><td valign='top'><table align='left' border='0' width='200' class='columnWrapper'><tr><td valign='top' class='columnContainer'></td></tr></table><table align='left' border='0' width='200' class='columnWrapper'><tr><td valign='top' class='columnContainer'></td></tr></table><table align='left' border='0' width='200' class='columnWrapper'><tr><td valign='top' class='columnContainer'></td></tr></table></td></tr></table></td></tr><tr><td align='left' valign='top' id='templateFooter'><table align='left' border='0' width='100%' class='templateContainer'><tr><td valign='top' class='footerContainer'><table border='0' width='100%' class='mcnFollowBlock' style='min-width:100%;'><tbody class='mcnFollowBlockOuter'><tr><td align='left' valign='top' style='padding:9px' class='mcnFollowBlockInner'><table border='0' width='100%' class='mcnFollowContentContainer' style='min-width:100%;'><tbody><tr><td align='left' style='padding-left:9px;padding-right:9px;'><table border='0' width='100%' style='min-width:100%;' class='mcnFollowContent'><tbody><tr><td align='left' valign='top' style='padding-top:9px; padding-right:9px; padding-left:9px;'><table align='left' border='0'><tbody><tr><td align='left' valign='top'><table align='left' border='0' style='display:inline;'><tbody><tr><td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'><table border='0' width='100%' class='mcnFollowContentItem'><tbody><tr><td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'><table align='left' border='0' width=''><tbody><tr><td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.instagram.com/danca_ccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-instagram-48.png' style='display:block;' height='24' width='24' class=''></a></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><table align='left' border='0' style='display:inline;'><tbody><tr><td valign='top' style='padding-right:10px; padding-bottom:9px;' class='mcnFollowContentItemContainer'><table border='0' width='100%' class='mcnFollowContentItem'><tbody><tr><td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'><table align='left' border='0' width=''><tbody><tr><td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='https://www.facebook.com/dancaccc/' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-facebook-48.png' style='display:block;' height='24' width='24' class=''></a></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><table align='left' border='0' style='display:inline;'><tbody><tr><td valign='top' style='padding-right:0; padding-bottom:9px;' class='mcnFollowContentItemContainer'><table border='0' width='100%' class='mcnFollowContentItem'><tbody><tr><td align='left' valign='middle' style='padding-top:5px; padding-right:10px; padding-bottom:5px; padding-left:9px;'><table align='left' border='0' width=''><tbody><tr><td align='left' valign='middle' width='24' class='mcnFollowIconContent'> <a href='http://dancaccc.com.br' target='_blank'> <img src='https://cdn-images.mailchimp.com/icons/social-block-v2/color-link-48.png' style='display:block;' height='24' width='24' class=''></a></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><table border='0' width='100%' class='mcnTextBlock' style='min-width:100%;'><tbody class='mcnTextBlockOuter'><tr><td valign='top' class='mcnTextBlockInner' style='padding-top:9px;'><table align='left' border='0' style='max-width:100%; min-width:100%;' width='100%' class='mcnTextContentContainer'><tbody><tr><td valign='top' class='mcnTextContent' style='padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;'>&nbsp;Qualquer dúvida sobre como proceder em rela&#231;&#227;o a assuntos ligados à sua matricula, click <a href='http://www.google.com' target='_blank'>aqui</a>&nbsp;ou ligue (21) 3176-1462 de segunda à sexta das 12:00hs às 21:00hs e fale com&nbsp;um de nossos funcionários.</td></tr></tbody></table></td></tr></tbody></table></td></tr></table></td></tr></table></td></tr></table></center></body></html>");

		
		int index = builder.indexOf("{{data}}");
		builder.replace(index, index + 8, sdf.format(new Date()));
		
		index = builder.indexOf("{{aluno}}");
		builder.replace(index, index + 9, mensalidade.getNomeAluno());
		
		index = builder.indexOf("{{mesReferencia}}");
		builder.replace(index, index + 17, mensalidade.getMesReferencia().getNomeMes());
		
		index = builder.indexOf("{{modalidade}}");
		builder.replace(index, index + 14, mensalidade.getNomeModalidade());
		
		index = builder.indexOf("{{valor}}");
		builder.replace(index, index + 9, new DecimalFormat("#.##").format(mensalidade.getValorMensalidade()));
		
		index = builder.indexOf("{{dataVencimento}}");
		builder.replace(index, index + 18, sdf.format(mensalidade.getDataVencimento()));
		
		System.out.println(builder.toString());
		email.setContent(builder.toString(), "text/html; charset=utf-8");

		try{
			email.send();
		}catch (EmailException e) {
			throw new RuntimeException("Falha ao enviar o comprovante para o email. Favor verificar se o email esta correto.");
		}

	}
}